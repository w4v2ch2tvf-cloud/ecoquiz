<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ â€” 10ë¬¸ì œ</title>
<style>
  :root{
    --bg1: #0f172a;
    --accent1: #7c3aed;
    --accent2: #06b6d4;
    --glass: rgba(255,255,255,0.06);
    --card-bg: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    --success: #22c55e;
    --danger: #ef4444;
    --text: #e6eef8;
    --muted: #a6b4c8;
    font-family: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  /* Full screen layout */
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent),
                                     radial-gradient(900px 500px at 90% 90%, rgba(6,182,212,0.08), transparent),
                                     var(--bg1); color:var(--text); -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
  .app{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    box-sizing:border-box;
  }

  .wrap{
    width:100%;
    max-width:1100px;
    height:90vh;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:28px;
    align-items:stretch;
  }

  /* Left: quiz card */
  .card{
    background:var(--card-bg);
    border-radius:18px;
    padding:28px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    backdrop-filter: blur(8px) saturate(120%);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    min-height:0;
  }

  .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }
  .title{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo{
    width:54px;height:54px;border-radius:12px;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    display:flex;align-items:center;justify-content:center;
    font-weight:700;color:white;font-size:20px;box-shadow:0 8px 30px rgba(12,12,20,0.6);
  }
  h1{margin:0;font-size:20px;letter-spacing:-0.2px;}
  p.lead{margin:0;color:var(--muted);font-size:13px;}

  .meta{
    text-align:right;
    font-size:13px;color:var(--muted);
  }
  .progress{
    width:100%;height:12px;border-radius:999px;background:rgba(255,255,255,0.04);margin:18px 0;overflow:hidden;
  }
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent1),var(--accent2));width:0%;transition:width 480ms cubic-bezier(.2,.9,.3,1);}

  .question-area{flex:1;display:flex;flex-direction:column;gap:14px;min-height:0;overflow:auto;padding-right:8px;}
  .qnum{font-size:13px;color:var(--muted)}
  .question{
    font-size:20px;line-height:1.35;margin-top:6px;
  }

  .choices{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px;}
  .choice{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:12px 14px;cursor:pointer;user-select:none;border:1px solid rgba(255,255,255,0.03);
    transition:transform 160ms ease, box-shadow 160ms ease, border-color 160ms;
    font-size:14px;color:var(--text);
    display:flex;align-items:center;gap:12px;
  }
  .choice:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(2,6,23,0.5);border-color:rgba(255,255,255,0.06);}
  .choice.disabled{cursor:default;opacity:0.95;transform:none;box-shadow:none}
  .choice .label{width:32px;height:32px;border-radius:8px;background:rgba(255,255,255,0.03);display:inline-flex;align-items:center;justify-content:center;font-weight:700;}
  .choice.correct{border-color:rgba(34,197,94,0.25);box-shadow:0 6px 18px rgba(34,197,94,0.06)}
  .choice.wrong{border-color:rgba(239,68,68,0.18);box-shadow:0 6px 18px rgba(239,68,68,0.06);opacity:0.9}

  .footer{
    display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:12px;
  }
  .btn{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    border:none;color:white;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600;
    box-shadow:0 10px 30px rgba(124,58,237,0.12);
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);font-weight:600}
  .timer{font-weight:700;color:var(--muted);font-size:13px}

  /* Right: stats / summary */
  .side{
    display:flex;flex-direction:column;gap:18px;
    min-height:0;
  }
  .card-small{background:var(--glass);border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 8px 20px rgba(2,6,23,0.5);}
  .stat{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
  }
  .big{
    font-size:40px;font-weight:800;letter-spacing:-1px;
  }
  .small{color:var(--muted);font-size:13px}

  /* final overlay */
  .overlay{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    background:linear-gradient(0deg, rgba(2,6,23,0.6), rgba(2,6,23,0.6));
    z-index:60;padding:24px;
  }
  .overlay.show{display:flex}
  .modal{width:100%;max-width:720px;background:linear-gradient(180deg,#0b1220, #071021);border-radius:16px;padding:28px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 30px 80px rgba(2,6,23,0.7);text-align:center}
  .modal h2{margin:8px 0 0 0;font-size:22px}
  .modal p{color:var(--muted);margin:8px 0 16px}
  .share{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap}

  /* responsiveness */
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr;align-items:start;height:auto;max-width:900px}
    .side{order:2}
    .card{order:1}
    .choices{grid-template-columns:1fr}
  }

  /* subtle focus */
  .choice:focus{outline:2px solid rgba(255,255,255,0.06)}
  /* small helper */
  .kbd{background:rgba(255,255,255,0.04);padding:6px 8px;border-radius:6px;font-weight:700;font-size:12px}
</style>
</head>
<body>
<div class="app">
  <div class="wrap" role="application" aria-labelledby="appTitle">
    <section class="card" aria-live="polite">
      <div>
        <div class="header">
          <div class="title">
            <div class="logo">EğŸŒ¿</div>
            <div>
              <h1 id="appTitle">ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ</h1>
              <p class="lead">ìì—°ì„ ì§€í‚¤ëŠ” ë˜‘ë˜‘ì´ í…ŒìŠ¤íŠ¸ â€” 10ë¬¸ì œ. 1~4 í‚¤ë¡œ ì„ íƒ ê°€ëŠ¥!</p>
            </div>
          </div>
          <div class="meta">
            <div class="kbd">í‚¤: 1 / 2 / 3 / 4</div>
            <div style="margin-top:8px;font-weight:700" id="qRemaining">ë¬¸ì œ 1 / 10</div>
          </div>
        </div>

        <div class="progress" aria-hidden="true"><i id="prog"></i></div>

        <div class="question-area" id="qArea">
          <div class="qnum" id="qNum">ë¬¸ì œ 1</div>
          <div class="question" id="questionText">ë¡œë”© ì¤‘...</div>

          <div class="choices" id="choices" role="listbox" aria-label="ì„ íƒì§€">
            <!-- choices ì‚½ì… -->
          </div>

          <div style="margin-top:12px;color:var(--muted);font-size:13px" id="feedback"></div>
        </div>
      </div>

      <div class="footer">
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn ghost" id="skipBtn">ê±´ë„ˆë›°ê¸° â¤´</button>
          <div class="timer" id="timer">ì‹œê°„: 00</div>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn" id="nextBtn" disabled>ë‹¤ìŒ â†’</button>
          <button class="btn ghost" id="restartBtn">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
      </div>
    </section>

    <aside class="side">
      <div class="card-small">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">ì ìˆ˜</div>
            <div class="big" id="score">0</div>
          </div>
          <div style="text-align:right">
            <div class="small">ì •ë‹µë¥ </div>
            <div style="font-size:20px;font-weight:800" id="percent">0%</div>
          </div>
        </div>
      </div>

      <div class="card-small">
        <div class="small">í€´ì¦ˆ ì •ë³´</div>
        <div style="margin-top:10px;color:var(--muted);font-size:14px">
          <div>- ë¬¸í•­: 10</div>
          <div>- ì„ íƒ: ê°ê´€ì‹ 4ì§€ì„ ë‹¤</div>
          <div>- í‚¤ë³´ë“œ 1~4 ì‚¬ìš© ê°€ëŠ¥</div>
          <div style="margin-top:10px">íŒ: ì‹¤ìˆ˜í•´ë„ ê±´ë„ˆë›°ê¸° ê°€ëŠ¥. ì •ë‹µ í™•ì¸ í›„ ë‹¤ìŒìœ¼ë¡œ!</div>
        </div>
      </div>

      <div class="card-small" id="historyCard">
        <div class="small">ìµœê·¼ í™œë™</div>
        <div id="history" style="margin-top:10px;color:var(--muted);font-size:13px;max-height:180px;overflow:auto">
          ì•„ì§ í’€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </aside>
  </div>
</div>

<!-- ê²°ê³¼ ì˜¤ë²„ë ˆì´ -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="resultTitle">
  <div class="modal">
    <div id="confetti" aria-hidden="true"></div>
    <h2 id="resultTitle">ê²°ê³¼</h2>
    <p id="resultText">ì ìˆ˜</p>
    <div style="display:flex;gap:10px;justify-content:center;margin-top:14px" class="share">
      <button class="btn" id="retake">ë‹¤ì‹œ í’€ê¸°</button>
      <button class="btn ghost" id="closeOverlay">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<script>
/* ********** ë°ì´í„°: 10ë¬¸í•­ (í•œê¸€) ********** */
const QUESTIONS = [
  {
    q: "ì§€êµ¬ì˜ í‰ê·  ê¸°ì˜¨ì´ ì¥ê¸°ê°„ì— ê±¸ì³ ìƒìŠ¹í•˜ëŠ” í˜„ìƒì„ ê°€ë¦¬í‚¤ëŠ” ìš©ì–´ëŠ”?",
    choices: ["ì˜¤ì¡´ì¸µ íŒŒê´´","ëŒ€ê¸° ì •ì²´","ì§€êµ¬ ì˜¨ë‚œí™”","ì—˜ë‹ˆë‡¨"],
    a: 2,
    explain: "ì§€êµ¬ ì˜¨ë‚œí™”(global warming)ëŠ” ì˜¨ì‹¤ê°€ìŠ¤ ì¦ê°€ë¡œ ì§€êµ¬ í‰ê·  ê¸°ì˜¨ì´ ì˜¤ë¥´ëŠ” í˜„ìƒì…ë‹ˆë‹¤."
  },
  {
    q: "ë‹¤ìŒ ì¤‘ ìƒë¬¼ ë‹¤ì–‘ì„±(biodiversity)ì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€?",
    choices: ["ë™ë¬¼ì˜ ê°œì²´ ìˆ˜ë§Œ","ì¢…ì˜ ë‹¤ì–‘ì„± + ìœ ì „ì  ë‹¤ì–‘ì„± + ìƒíƒœê³„ ë‹¤ì–‘ì„±","ì˜¤ì§ ì‹ë¬¼ì˜ ë‹¤ì–‘ì„±","ë©¸ì¢…ëœ ì¢…ì˜ ìˆ˜"],
    a: 1,
    explain: "ìƒë¬¼ ë‹¤ì–‘ì„±ì€ ì¢…ë‹¤ì–‘ì„±, ìœ ì „ë‹¤ì–‘ì„±, ìƒíƒœê³„ ë‹¤ì–‘ì„±ì„ ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤."
  },
  {
    q: "ì¬í™œìš© ê°€ëŠ¥í•œ í”Œë¼ìŠ¤í‹± í‘œì‹œ ì¤‘ 'í”Œë¼ìŠ¤í‹± ì¢…ë¥˜ ë²ˆí˜¸'ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì€?",
    choices: ["ì‹¬ë³¼ì˜ ì‚¼ê°í˜• ì•ˆ ìˆ«ì","ìƒ‰ê¹”","ì¬í™œìš© ê°€ëŠ¥í•œ ë¬¸êµ¬","ì œì¡°ì‚¬ ë¡œê³ "],
    a: 0,
    explain: "í”Œë¼ìŠ¤í‹± ì¢…ë¥˜ëŠ” ì‚¼ê°í˜• í™”ì‚´í‘œ ì•ˆì˜ ìˆ«ìë¡œ í‘œì‹œë©ë‹ˆë‹¤ (1~7)."
  },
  {
    q: "íƒ„ì†Œ ì¤‘ë¦½(carbon neutrality)ì˜ í•µì‹¬ ê°œë…ì€?",
    choices: ["íƒ„ì†Œ ì‚¬ìš©ì„ ë¬´ì¡°ê±´ ì¤‘ë‹¨","ë°°ì¶œí•œ íƒ„ì†Œë¥¼ ë™ì¼ëŸ‰ í¡ìˆ˜í•˜ê±°ë‚˜ ìƒì‡„","íƒ„ì†Œë¥¼ ëª¨ë‘ ë•…ì†ì— ì €ì¥","í™”ì„ì—°ë£Œë§Œ ì‚¬ìš©"],
    a: 1,
    explain: "íƒ„ì†Œ ì¤‘ë¦½ì€ ë°°ì¶œí•œ íƒ„ì†ŒëŸ‰ê³¼ ì œê±°(í¡ìˆ˜/ìƒì‡„)í•œ ì–‘ì´ ê°™ì•„ ìˆœë°°ì¶œì´ 0ì¸ ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤."
  },
  {
    q: "ì‚°í˜¸ì´ˆê°€ ì‹¬ê°í•˜ê²Œ í›¼ì†ë˜ë©´ ì§€ì—­ ìƒíƒœê³„ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ìœ¼ë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    choices: ["ì–´ë¥˜ ì„œì‹ì§€ ìƒì‹¤","í•´ì•ˆ ì¹¨ì‹ ì¦ê°€","í•´ìˆ˜ì˜ ì—¼ë¶„ì´ ê°‘ìê¸° ê°ì†Œ","ê´€ê´‘ ìˆ˜ì… ê°ì†Œ"],
    a: 2,
    explain: "í•´ìˆ˜ ì—¼ë¶„ì´ ê°‘ìê¸° ê°ì†Œí•˜ëŠ” ê²ƒì€ ì‚°í˜¸ í›¼ì†ì˜ ì§ì ‘ì  ê²°ê³¼ê°€ ì•„ë‹™ë‹ˆë‹¤."
  },
  {
    q: "ìƒíƒœê³„ ì„œë¹„ìŠ¤ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ì˜ˆëŠ”?",
    choices: ["ìˆ˜ì§ˆ ì •í™”","ë†ì‘ë¬¼ ìˆ˜ë¶„(ìˆ˜ë¶„ ë§¤ê°œì)","ì˜¤ì—¼ë¬¼ì§ˆ ë¬´ì œí•œ ìƒì„±","ê¸°í›„ ì¡°ì ˆ"],
    a: 2,
    explain: "ìƒíƒœê³„ ì„œë¹„ìŠ¤ëŠ” ì¸ê°„ì—ê²Œ ìœ ìš©í•œ ê¸°ëŠ¥ì„ ë§í•˜ë©° 'ì˜¤ì—¼ë¬¼ì§ˆ ë¬´ì œí•œ ìƒì„±'ì€ í•´ë‹¹í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
  },
  {
    q: "ë¹„ë‹ë´‰íˆ¬ ëŒ€ì‹  ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì¥ë°”êµ¬ë‹ˆë¥¼ ê¶Œì¥í•˜ëŠ” ì´ìœ ëŠ”?",
    choices: ["ê°€ê²©ì´ ì‹¸ì„œ","ì¼íšŒìš© ì“°ë ˆê¸° ê°ì†Œ, ìì› ì ˆì•½","ë” ë³´ê¸° ì¢‹ê¸° ë•Œë¬¸ì—","ë¬´ì¡°ê±´ ë²•ì  ì˜ë¬´ë¼ì„œ"],
    a: 1,
    explain: "ì¬ì‚¬ìš© ì¥ë°”êµ¬ë‹ˆ ì‚¬ìš©ì€ ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì—¬ ì“°ë ˆê¸°ì™€ ìì› ì†Œë¹„ë¥¼ ë‚®ì¶¥ë‹ˆë‹¤."
  },
  {
    q: "ë‹¤ìŒ ì¤‘ 'ì§€ì†ê°€ëŠ¥ë°œì „ ëª©í‘œ(SDGs)'ì— í¬í•¨ë˜ëŠ” ë‚´ìš©ì€?",
    choices: ["ë¹ˆê³¤ í‡´ì¹˜","ìš°ì£¼ì—¬í–‰ í™œì„±í™”","ì „ìŸ ìœ ë„","í•µë¬´ê¸° í™•ëŒ€"],
    a: 0,
    explain: "SDGëŠ” ë¹ˆê³¤í‡´ì¹˜, ê¸°ì•„ì¢…ì‹, ì–‘ì§ˆì˜ êµìœ¡, ê¸°í›„í–‰ë™ ë“± ì§€ì†ê°€ëŠ¥í•œ ëª©í‘œë¥¼ í¬í•¨í•©ë‹ˆë‹¤."
  },
  {
    q: "ì˜¨ì‹¤ê°€ìŠ¤ ì¤‘ì—ì„œ ì¸ê°„ í™œë™ìœ¼ë¡œ ì¸í•œ ì¦ê°€ê°€ íŠ¹íˆ ë¬¸ì œë˜ëŠ” ê°€ìŠ¤ê°€ ì•„ë‹Œ ê²ƒì€?",
    choices: ["ì´ì‚°í™”íƒ„ì†Œ(CO2)","ë©”íƒ„(CH4)","ì§ˆì†Œ(N2)","ì•„ì‚°í™”ì§ˆì†Œ(N2O)"],
    a: 2,
    explain: "ì§ˆì†Œê°€ìŠ¤(N2)ëŠ” ëŒ€ê¸°ì˜ ì£¼ì„±ë¶„ì´ì§€ë§Œ ì˜¨ì‹¤íš¨ê³¼ë¥¼ ì¼ìœ¼í‚¤ëŠ” ê°€ìŠ¤ëŠ” ì•„ë‹™ë‹ˆë‹¤."
  },
  {
    q: "ìì—° ì„œì‹ì§€ í›¼ì†ì„ ë§‰ê¸° ìœ„í•œ êµ¬ì²´ì  ë°©ë²•ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?",
    choices: ["ë„ì‹œ í™•ì¥ ì‹œ ë¬´ë¶„ë³„í•œ ê°œë°œ","ë³´í˜¸êµ¬ì—­ ì„¤ì • ë° ìƒíƒœë³µì›","ë¶ˆí•„ìš”í•œ ì‚°ì§€ í›¼ì† ì¥ë ¤","ë©¸ì¢…ìœ„ê¸°ì¢… í¬íš ì¦ê°€"],
    a: 1,
    explain: "ë³´í˜¸êµ¬ì—­ ì§€ì •ê³¼ ë³µì›ì€ ì„œì‹ì§€ ë³´ì „ì˜ í•µì‹¬ ì „ëµì…ë‹ˆë‹¤."
  }
];

/* ********** ìƒíƒœ ë³€ìˆ˜ ********** */
let current = 0;
let score = 0;
let answeredCount = 0;
const total = QUESTIONS.length;
let allowNext = false;
let timerInterval = null;
let timePerQuestion = 20; // ì´ˆ
let remainingTime = timePerQuestion;

/* ********** UI ë ˆí¼ëŸ°ìŠ¤ ********** */
const qNumEl = document.getElementById('qNum');
const questionText = document.getElementById('questionText');
const choicesEl = document.getElementById('choices');
const prog = document.getElementById('prog');
const qRemaining = document.getElementById('qRemaining');
const nextBtn = document.getElementById('nextBtn');
const skipBtn = document.getElementById('skipBtn');
const restartBtn = document.getElementById('restartBtn');
const scoreEl = document.getElementById('score');
const percentEl = document.getElementById('percent');
const feedback = document.getElementById('feedback');
const timerEl = document.getElementById('timer');
const overlay = document.getElementById('overlay');
const resultText = document.getElementById('resultText');
const historyEl = document.getElementById('history');
const retake = document.getElementById('retake');
const closeOverlay = document.getElementById('closeOverlay');

/* ********** ì´ˆê¸°í™” ********** */
function init(){
  current = 0; score = 0; answeredCount = 0;
  updateMeta();
  renderQuestion();
  updateScore();
  loadHistory();
}

function updateMeta(){
  qNumEl.textContent = `ë¬¸ì œ ${current+1}`;
  qRemaining.textContent = `ë¬¸ì œ ${current+1} / ${total}`;
  prog.style.width = `${((current)/total)*100}%`;
}

/* ********** íƒ€ì´ë¨¸ ********** */
function startTimer(){
  clearInterval(timerInterval);
  remainingTime = timePerQuestion;
  timerEl.textContent = `ì‹œê°„: ${pad(remainingTime)}`;
  timerInterval = setInterval(()=>{
    remainingTime--;
    timerEl.textContent = `ì‹œê°„: ${pad(remainingTime)}`;
    if(remainingTime <= 0){
      clearInterval(timerInterval);
      onTimeUp();
    }
  },1000);
}
function stopTimer(){ clearInterval(timerInterval); }
function pad(n){ return n<10? '0'+n: String(n); }

/* ********** ë¬¸ì œ ë Œë”ë§ ********** */
function renderQuestion(){
  allowNext = false;
  nextBtn.disabled = true;
  feedback.textContent = '';
  const item = QUESTIONS[current];
  questionText.textContent = item.q;
  choicesEl.innerHTML = '';
  item.choices.forEach((c, idx) => {
    const btn = document.createElement('button');
    btn.className = 'choice';
    btn.type = 'button';
    btn.setAttribute('data-index', idx);
    btn.setAttribute('role','option');
    btn.innerHTML = `<div class="label">${String.fromCharCode(65+idx)}</div><div style="flex:1;text-align:left">${c}</div>`;
    btn.addEventListener('click', onChoice);
    choicesEl.appendChild(btn);
  });
  updateMeta();
  startTimer();
}

/* ********** ì„ íƒ ì²˜ë¦¬ ********** */
function onChoice(e){
  if(allowNext) return;
  const idx = Number(e.currentTarget.getAttribute('data-index'));
  grade(idx);
}

function grade(sel){
  allowNext = true;
  stopTimer();
  answeredCount++;
  const correct = QUESTIONS[current].a;
  const nodes = Array.from(choicesEl.children);
  nodes.forEach((n)=>{
    n.classList.add('disabled');
    const i = Number(n.getAttribute('data-index'));
    if(i === correct) n.classList.add('correct');
    if(i === sel && i !== correct) n.classList.add('wrong');
  });

  // ì ìˆ˜ ë¡œì§: ì •ë‹µì´ë©´ +10
  if(sel === correct){
    score += 10;
    feedback.innerHTML = `<strong style="color:var(--success)">ì •ë‹µ!</strong> â€” ${QUESTIONS[current].explain}`;
  } else {
    feedback.innerHTML = `<strong style="color:var(--danger)">ì˜¤ë‹µ</strong> â€” ì •ë‹µ: ${String.fromCharCode(65+correct)}. ${QUESTIONS[current].explain}`;
  }
  updateScore();
  saveHistory(current, sel === correct);
  nextBtn.disabled = false;
  prog.style.width = `${((current+1)/total)*100}%`;
}

/* ********** ì‹œê°„ ì´ˆê³¼ ********** */
function onTimeUp(){
  allowNext = true;
  answeredCount++;
  const correct = QUESTIONS[current].a;
  const nodes = Array.from(choicesEl.children);
  nodes.forEach((n)=>{
    n.classList.add('disabled');
    const i = Number(n.getAttribute('data-index'));
    if(i === correct) n.classList.add('correct');
  });
  feedback.innerHTML = `<strong style="color:var(--danger)">ì‹œê°„ ì´ˆê³¼</strong> â€” ì •ë‹µ: ${String.fromCharCode(65+correct)}. ${QUESTIONS[current].explain}`;
  saveHistory(current, false);
  nextBtn.disabled = false;
  prog.style.width = `${((current+1)/total)*100}%`;
}

/* ********** ë‹¤ìŒ, ê±´ë„ˆë›°ê¸°, ë‹¤ì‹œí•˜ê¸° ********** */
nextBtn.addEventListener('click', ()=>{
  goNext();
});
skipBtn.addEventListener('click', ()=>{
  if(!allowNext){ // skip before answering: treat as unanswered (no points)
    stopTimer();
    onTimeUp(); // reveal answer
  } else {
    goNext();
  }
});
restartBtn.addEventListener('click', ()=>{
  if(confirm('í€´ì¦ˆë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í’€ê¹Œìš”?')) {
    init();
  }
});
function goNext(){
  stopTimer();
  if(current < total -1){
    current++;
    renderQuestion();
  } else {
    // ë
    showResult();
  }
}

/* ********** ì ìˆ˜ í‘œì‹œ ********** */
function updateScore(){
  scoreEl.textContent = score;
  const pct = Math.round((score / (10*total)) * 100);
  percentEl.textContent = `${pct}%`;
}

/* ********** ê²°ê³¼ ëª¨ë‹¬ ********** */
function showResult(){
  stopTimer();
  overlay.classList.add('show');
  const pct = Math.round((score / (10*total)) * 100);
  resultText.innerHTML = `<strong style="font-size:28px">${score} / ${10*total}</strong><br>${pct}% â€” ${resultMessage(pct)}`;
  // simple confetti effect (CSS sparkle)
  playConfetti();
}

retake.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  init();
});
closeOverlay.addEventListener('click', ()=>{
  overlay.classList.remove('show');
});

/* ********** ê²°ê³¼ ë©”ì‹œì§€ ********** */
function resultMessage(pct){
  if(pct === 100) return 'ì •ë§ ìµœê³ ì˜ˆìš”! ğŸŒŸ ì§€êµ¬ê°€ ê¸°ë»í•©ë‹ˆë‹¤.';
  if(pct >= 80) return 'ì •ë‹µë¥  ì•„ì£¼ ì¢‹ì•„ìš”! ê³„ì† ì‹¤ì²œí•´ìš”.';
  if(pct >= 50) return 'ë³´í†µì´ì—ìš” â€” ë” ì•Œì•„ë³´ë©´ ì ìˆ˜ UP!';
  return 'ê´œì°®ì•„ìš” â€” ë°°ìš°ëŠ” ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒì—” ë” ì˜í•  ìˆ˜ ìˆì–´ìš”!';
}

/* ********** íˆìŠ¤í† ë¦¬ ì €ì¥ (ì„¸ì…˜) ********** */
function saveHistory(qIndex, correct){
  const key = 'eco_quiz_history_v1';
  let hist = JSON.parse(localStorage.getItem(key) || "[]");
  hist.unshift({time:new Date().toISOString(), q:qIndex, correct});
  hist = hist.slice(0,20);
  localStorage.setItem(key, JSON.stringify(hist));
  loadHistory();
}
function loadHistory(){
  const key = 'eco_quiz_history_v1';
  const hist = JSON.parse(localStorage.getItem(key) || "[]");
  if(hist.length === 0){
    historyEl.textContent = 'ì•„ì§ í’€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
    return;
  }
  historyEl.innerHTML = hist.map(h=>{
    const d = new Date(h.time);
    const qText = QUESTIONS[h.q].q;
    return `<div style="margin-bottom:8px">
      <div style="font-size:12px;color:var(--muted)">${d.toLocaleString()}</div>
      <div style="font-size:13px">${qText}<div style="color:${h.correct? 'var(--success)':'var(--danger)'};font-weight:700;margin-top:4px">${h.correct? 'ì •ë‹µ':'ì˜¤ë‹µ'}</div></div>
    </div>`;
  }).join('');
}

/* ********** í‚¤ë³´ë“œ ì§€ì› 1-4, Enter(ë‹¤ìŒ) ********** */
document.addEventListener('keydown', (e)=>{
  if(e.key >= '1' && e.key <= '4'){
    const idx = Number(e.key) - 1;
    const btn = choicesEl.querySelector(`[data-index="${idx}"]`);
    if(btn && !btn.classList.contains('disabled')){
      btn.click();
    }
  }
  if(e.key === 'Enter'){
    if(!nextBtn.disabled) nextBtn.click();
  }
});

/* ********** ì»¨í˜í‹° (ê°„ë‹¨) ********** */
function playConfetti(){
  // create a few animated colored dots
  const c = document.createElement('div');
  c.style.position='absolute';
  c.style.inset='0';
  c.style.pointerEvents='none';
  const colors = ['#7c3aed','#06b6d4','#f97316','#22c55e'];
  for(let i=0;i<30;i++){
    const dot = document.createElement('div');
    const size = Math.random()*12+6;
    dot.style.width = dot.style.height = size+'px';
    dot.style.borderRadius='50%';
    dot.style.background = colors[Math.floor(Math.random()*colors.length)];
    dot.style.position='absolute';
    dot.style.left = (50 + (Math.random()*80-40)) + '%';
    dot.style.top = '30%';
    dot.style.opacity = '0.95';
    dot.style.transform = `translateY(0) translateX(0) scale(1)`;
    dot.style.transition = `transform ${1.2+Math.random()*0.8}s cubic-bezier(.2,.85,.32,1), opacity 1s linear`;
    c.appendChild(dot);
    setTimeout(()=> {
      dot.style.transform = `translateY(${120 + Math.random()*200}px) translateX(${(Math.random()*400-200)}px) rotate(${Math.random()*360}deg) scale(.6)`;
      dot.style.opacity = '0.0';
    }, 30 + i*20);
  }
  const modal = document.querySelector('.modal');
  modal.appendChild(c);
  setTimeout(()=> c.remove(), 2200);
}

/* ********** ì´ˆê¸° ì‹¤í–‰ ********** */
init();
</script>
</body>
</html>
